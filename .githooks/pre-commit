#!/bin/bash

# Pre-commit hook to catch SSR issues like Amplify
echo "ğŸ” Running pre-commit checks..."

# Check for TypeScript errors with strict config
echo "ğŸ“ Checking TypeScript (strict mode)..."
npx tsc --project tsconfig.strict.json --noEmit
if [ $? -ne 0 ]; then
  echo "âŒ TypeScript strict check failed"
  exit 1
fi

# Run ESLint
echo "ğŸ”§ Running ESLint..."
npx eslint . --ext .ts,.tsx
if [ $? -ne 0 ]; then
  echo "âŒ ESLint failed"
  exit 1
fi

# Build packages
echo "ğŸ“¦ Building packages..."
pnpm run build:packages
if [ $? -ne 0 ]; then
  echo "âŒ Package build failed"
  exit 1
fi

# Strict production build
echo "ğŸ—ï¸ Running strict production build..."
pnpm run build:strict
if [ $? -ne 0 ]; then
  echo "âŒ Strict build failed - this would fail on Amplify!"
  exit 1
fi

echo "âœ… All pre-commit checks passed!"
exit 0
